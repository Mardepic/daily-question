<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Päiväkirja 2026</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
h1 { text-align: center; }
.week-nav { text-align: center; margin: 20px 0; }
button { margin: 0 10px; padding: 8px 16px; }
.day-card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.day-title { font-weight: bold; margin-bottom: 5px; }
.question { margin-bottom: 10px; font-style: italic; }
textarea { width: 100%; border-radius: 10px; padding: 8px; resize: vertical; }
</style>
</head>
<body>

<h1>Päiväkirja 2026</h1>
<div class="week-nav">
    <button onclick="prevWeek()">← Edellinen viikko</button>
    <span id="weekNumber">Viikko 1</span>
    <button onclick="nextWeek()">Seuraava viikko →</button>
</div>
<div id="weekContainer"></div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyCJR7kIaO5R6b-mDigcaBUZbIv4lZhPd3g",
    authDomain: "reflection-diary-2026-d9b75.firebaseapp.com",
    projectId: "reflection-diary-2026-d9b75",
    storageBucket: "reflection-diary-2026-d9b75.firebasestorage.app",
    messagingSenderId: "40162654025",
    appId: "1:40162654025:web:49d152a55fced628f78c98",
    measurementId: "G-3RFHJPQV5Q"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);

// -------------------- USER AUTH --------------------
let currentUser = null;

// Simple login for demo; you can expand with registration
const email = prompt("Anna sähköpostisi (demo login):");
const password = prompt("Anna salasana:");

signInWithEmailAndPassword(auth, email, password)
.then(userCredential => { 
    currentUser = userCredential.user; 
    generateWeek(currentWeek); 
})
.catch(err => alert("Kirjautuminen epäonnistui: " + err.message));

// -------------------- CALENDAR LOGIC --------------------
const year = 2026;
let currentWeek = 1;
const days = ["Ma","Ti","Ke","To","Pe","La","Su"];

// ISO week helpers
function getDateOfISOWeek(week, year) {
    const simple = new Date(year, 0, 1 + (week - 1) * 7);
    const dow = simple.getDay();
    const ISOweekStart = simple;
    if(dow <= 4) ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
    else ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
    return ISOweekStart;
}

function formatDate(date) {
    return date.getDate() + "." + (date.getMonth()+1) + "." + date.getFullYear();
}

// -------------------- YEAR DATA --------------------
const yearData = {
  "Tammikuu": [
    "Mikä saa sinut tuntemaan itsesi eläväksi?",
    "Millainen haluaisit olla kymmenen vuoden päästä?",
    "Mikä on paras neuvo, jonka olet koskaan saanut?",
    "Mistä asiasta olet viimeksi muuttanut mielipidettäsi?",
    "Mikä lapsuusmuistosi on kirkkain?",
    "Millaista rakkautta haluat elämääsi?",
    "Mikä pelko estää sinua tällä hetkellä?",
    "Kenelle olet kiitollinen ja miksi?",
    "Mikä on suurin saavutuksesi tähän mennessä?",
    "Millainen on täydellinen päiväsi?",
    "Mitä haluaisit oppia tänä vuonna?",
    "Mikä asia sinussa on muuttunut viimeisen vuoden aikana?",
    "Milloin viimeksi teit jotain ensimmäistä kertaa?",
    "Mikä on tärkein arvosi?",
    "Keneltä haluaisit pyytää anteeksi?",
    "Mikä unelma tuntuu mahdottomalta?",
    "Millaisissa tilanteissa olet parhaimmillasi?",
    "Mitä sinulle merkitsee menestys?",
    "Mikä ominaisuutesi on vahvuutesi?",
    "Mistä luovut helposti ja mistä et?",
    "Millainen ympäristö saa sinut voimaan hyvin?",
    "Mikä musiikkikappale kuvaa tämänhetkistä elämääsi?",
    "Keneen olet viimeksi ihailevasti suhtautunut?",
    "Mikä tekee sinusta uniikin?",
    "Millaista ystävyyttä haluat vaalia?",
    "Mikä asia elämässäsi kaipaa muutosta?",
    "Milloin olet viimeksi nauranut kunnolla?",
    "Mitä haluat sanoa itsellesi viiden vuoden päästä?",
    "Mikä on suurin haaveesi?",
    "Mistä haluaisit päästää irti?",
    "Mikä sinussa on pysynyt samana lapsesta asti?"
  ],
  // Lisää helmikuu–joulukuu samalla tavalla (voit liittää kaikki kysymykset)
};

// -------------------- WEEK GENERATION --------------------
function getQuestionForDate(date) {
    const monthIndex = date.getMonth();
    const monthNames = Object.keys(yearData);
    const monthQuestions = yearData[monthNames[monthIndex]];
    // Käytetään modulo niin ei mene yli
    return monthQuestions[(date.getDate() - 1) % monthQuestions.length];
}

function generateWeek(weekNumber) {
    if(!currentUser) return; // odotetaan kirjautumista
    const container = document.getElementById("weekContainer");
    const weekNumberDiv = document.getElementById("weekNumber");

    const weekStart = getDateOfISOWeek(weekNumber, year);
    const weekEnd = new Date(weekStart);
    weekEnd.setDate(weekStart.getDate() + 6);

    weekNumberDiv.innerText = "Viikko " + weekNumber + " – " +
        formatDate(weekStart) + " – " + formatDate(weekEnd);

    container.innerHTML = "";

    for(let i=0;i<7;i++){
        const date = new Date(weekStart);
        date.setDate(weekStart.getDate() + i);
        const question = getQuestionForDate(date);
        const key = year + "-" + date.toISOString().split("T")[0];

        const card = document.createElement("div");
        card.className = "day-card";
        card.innerHTML = `
            <div class="day-title">${days[i]} ${formatDate(date)}</div>
            <div class="question">${question}</div>
            <textarea rows="4" placeholder="Kirjoita ajatuksesi tähän..." style="width:100%; margin-top:10px; border-radius:10px; padding:8px;"></textarea>
        `;

        const textarea = card.querySelector("textarea");

        // Lataa vastaus Firestoresta, jos olemassa
        getDoc(doc(db, "diary", currentUser.uid + "_" + key)).then(docSnap=>{
            if(docSnap.exists()) textarea.value = docSnap.data().answer;
        });

        // Tallenna Firestoreen muutoksessa
        textarea.addEventListener("change", async () => {
            await setDoc(doc(db, "diary", currentUser.uid + "_" + key), { answer: textarea.value });
        });

        container.appendChild(card);
    }
}

// -------------------- WEEK NAVIGATION --------------------
function nextWeek(){ if(currentWeek<53){ currentWeek++; generateWeek(currentWeek); } }
function prevWeek(){ if(currentWeek>1){ currentWeek--; generateWeek(currentWeek); } }

</script>

</body>
</html>
